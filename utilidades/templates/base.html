<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% block metas %}

    {% endblock %}
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>  
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script> 
    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script> 
    {% block css%}
    {% load static %}
      <link rel="stylesheet" href="{% static "css/estilos.css" %}">
    {% endblock %}
    {% block titulo %}
      <title>Inicio</title>
  {% endblock %}
  {% load pwa %}
  {% progressive_web_app_meta %}

<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-messaging.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->

<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyAR9PUtdwzw0uBMLsWDXHxYtWTwc-2g9s4",
    authDomain: "superstore-8a.firebaseapp.com",
    databaseURL: "https://superstore-8a.firebaseio.com",
    projectId: "superstore-8a",
    storageBucket: "superstore-8a.appspot.com",
    messagingSenderId: "716148899925",
    appId: "1:716148899925:web:1eccc051bf03249485d4dc"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

  let messaging = firebase.messaging();
  //primero tenemos que enlazar con el service worker
  navigator.serviceWorker
  .register('../serviceworker.js')
  .then(function(register){
    messaging.useServiceWorker(register);
    //solicitamos el permiso para recibir noificaciones del usuario
    messaging.requestPermission()
    .then(function(){
      console.log("El usuario ha aceptado recibir notificaciones");
      
      return messaging.getToken();//obteniendo el token de cada usuario
    })
    .then(function(token){
      console.log(token);
      //enviaremos el token hacia django para guardarlo en la db
      fetch('guardar-token/',{
        method:'post',
        headers:{
          'content-type':'application/json',
          'accept':'application/json'
        },
        body:JSON.stringify({
          'token':token
        })
      }).then(function(resultado){
        console.log("se ha guardado el token");
      }).catch(function(e){
        console.log("no se a podido guaradr el token");
      });
    })
    .catch(function(e){
      console.log("El usuario no ha aceptado recibir notificaciones");
    });
  });

  //programamos la recepcion de las notificaciones push
  messaging.onMessage(function(payload){
    let data = payload.notification
    console.log(data);
    let title = data.title;
    let options = {
      body:data.body,
      icon:data.icon
    };
    let mensaje = new Notification(title, options);
  });

</script>

  </head>
<body>
    {% block encabezado %}

    {% endblock %}
  {% block contenido %}
    {# col, col-sm-*, col-md-*, col-lg-*, col-xl-* #}
    <div class="container-fluid">
        {# barra de navegacion #}
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="{% url 'tienda:index' %}">SuperStoreSv</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              {% block clave %}
                <form class="form-inline my-2 my-lg-0">
                  <input class="form-control mr-sm-2" type="search" placeholder="Buscar" aria-label="Search">
                  <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Buscar</button>
                </form>
              {% endblock %}
              {% block item %}
              <ul class="navbar-nav mr-auto nav-tabs">
                  <li class="nav-item">
                    <a class="nav-link" href="#">Cesta</a>
                  </li>
                  {% block autenticacion %}
                  <li class="nav-item">
                    <a id="registrar" class="nav-link" href="{% url 'tienda:registrar' %}" tabindex="-1" aria-disabled="true">Registrarse</a>
                  </li>
                  <li class="nav-item">
                    <a href="{% url 'tienda:login' %}" class="nav-link">Identificarse</a>
                  </li>
                  {% endblock %}
              </ul>
              {% endblock %}
              {% block logout%}

              {% endblock %}
            </div>
          </nav>
          {# fin de la barra de navegacion #}
          {# inicio de la barra de las categorias #}
          {% block  categoria %}
          
          {% endblock %}
          {% block anuncios %}
              {# fin de la barra de la izquierda de la categorias #}
              <div class="col-xl-8">{# colocando el carouser de promociones  #}
                <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                      <div class="carousel-item active">
                        <img class="d-block w-100" src="..." alt="First slide">
                      </div>
                      <div class="carousel-item">
                        <img class="d-block w-100" src="..." alt="Second slide">
                      </div>
                      <div class="carousel-item">
                        <img class="d-block w-100" src="..." alt="Third slide">
                      </div>
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                      <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      <span class="sr-only">Next</span>
                    </a>
                  </div>
              </div>
              {% endblock %}
              {# fin del carouser #}
          
          {# contenido las ventas #}
          {% block ventas %}


            {% endblock %}          
              {# aqui inicia el pie de pagina #}
              <!-- Footer -->
                <footer class="page-footer font-small blue pt-4">

                    <!-- Footer Links -->
                    <div class="container-fluid text-center text-md-left">
                
                    <!-- Grid row -->
                    <div class="row">
                
                        <!-- Grid column -->
                        <div class="col-md-6 mt-md-0 mt-3">
                
                        <!-- Content -->
                        <h5 class="text-uppercase">Footer Content</h5>
                        <p>Here you can use rows and columns to organize your footer content.</p>
                
                        </div>
                        <!-- Grid column -->
                
                        <hr class="clearfix w-100 d-md-none pb-3">
                
                        <!-- Grid column -->
                        <div class="col-md-3 mb-md-0 mb-3">
                
                        <!-- Links -->
                        <h5 class="text-uppercase">Links</h5>
                
                        <ul class="list-unstyled">
                            <li>
                            <a href="#!">Link 1</a>
                            </li>
                            <li>
                            <a href="#!">Link 2</a>
                            </li>
                            <li>
                            <a href="#!">Link 3</a>
                            </li>
                            <li>
                            <a href="#!">Link 4</a>
                            </li>
                        </ul>
                
                        </div>
                        <!-- Grid column -->
                
                        <!-- Grid column -->
                        <div class="col-md-3 mb-md-0 mb-3">
                
                        <!-- Links -->
                        <h5 class="text-uppercase">Links</h5>
                
                        <ul class="list-unstyled">
                            <li>
                            <a href="#!">Link 1</a>
                            </li>
                            <li>
                            <a href="#!">Link 2</a>
                            </li>
                            <li>
                            <a href="#!">Link 3</a>
                            </li>
                            <li>
                            <a href="#!">Link 4</a>
                            </li>
                        </ul>
                
                        </div>
                        <!-- Grid column -->
                
                    </div>
                    <!-- Grid row -->
                
                    </div>
                    <!-- Footer Links -->
                
                    <!-- Copyright -->
                    <div class="footer-copyright text-center py-3">Â© 2020 Copyright:
                    <a href="https://mdbootstrap.com/"> MDBootstrap.com</a>
                    </div>
                    <!-- Copyright -->
                </footer>
                <!-- Footer -->

    </div>
    {% block pie %}{# pie de pagina de las demas paginas #}

    {% endblock %}
    {% endblock %}
    {% block script %}

    {% endblock %}
</body>
</html>